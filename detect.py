import pandas as pd
import pyaxmlparser
import joblib

df = pd.read_csv('dataset\drebin-215-dataset-5560malware-9476-benign.csv.zip')
df.columns = map(str.lower, df.columns)
#print(df)

# apk = "bitbar-sample-app.apk"

def detectMalware(apk):
    apk = pyaxmlparser.APK(apk)
    features = []
    permissions = apk.get_permissions()
    features.extend(permissions)
    #print(features)

    allFeatures = []
    for item in features:
        permissions = item.split('.')
        allFeatures.append(permissions[-1].lower())
    #print(allFeatures)

    df1 = df
    df1 = df1.loc[:0]
    df1 = df1.assign(**{col: 0 for col in df.columns})

    for item in allFeatures:
        if item in df1:
            df1[item] = 1

    df1 = df1.iloc[:, :-1] 

    model = joblib.load('random_forest_model.joblib')
    X_test = df1.values
    #print(X_test)

    predictions = model.predict(X_test)

    for prediction in predictions:
        if prediction == 1:
            return "Malware"
        else:
            return "Benign"

        # print("Malware" if prediction == 1 else "Benign")


# result = detectMalware(apk)
# print(result)










